2/20
1.train.py修改optim为Adadelta （先不改，param不知道是传入的什么参数）--问
2.原代码没用clip_grad
3.loss函数输入的两个参数可能有问题  --先检查这个 --正确
4.增加测试集，对比test和train的loss：（其实是validation set）--testset怎么加
    train loss 不断下降，test loss不断下降，说明网络仍在学习;

    train loss 不断下降，test loss趋于不变，说明网络过拟合;

    train loss 趋于不变，test loss不断下降，说明数据集100%有问题;

    train loss 趋于不变，test loss趋于不变，说明学习遇到瓶颈，需要减小学习率或批量数目;

    train loss 不断上升，test loss不断上升，说明网络结构设计不当，训练超参数设置不当，数据集经过清洗等问题。
5.memory没有加上
6.optimizer怎么知道要优化哪些参数？--问
7.CrossEntropyLoss的参数 --正确
input: batch*class 2D
target: batch    1D

2/21 
不加memory的原结果：
1/7
霜雪====外天霜雪夜乐来	三千万里雨声多	江南新竹几回还	风露如今一百波

2/7
断肠====有肠灵草断头通	不觉东风未得春	寄语从来无影梦	一枝烟叶起黄尘

3/7
红烛====西坐红丝发少疑	有酒杯中道春非	老心回直著故人	城阴合满青灯飞

4/7
杨柳====一树杨花柳欲如	行人犹得看春游	黄金莫笑身先在	又见新亭数日愁

5/7
Cannot generate poem meeting all restrictions
6/7
泪别====忆别池边泪满地	恨中疏月上九天	当时对取无年客	闲入秋风寄草船

7/7
脂粉====春胜霜心那可香	半生一色照芳新	坐中未敢教燕解	始见风吹动雨亲

代码修改：
1.增加validate函数，train中也加了部分val的步骤，注释掉了。暂时不用验证集了。

TODO：
1.修改模型保存命名。不要覆盖。

目前模型:
training set: 480
batch size: 80
optimizer: AdaDelta
loss: CrossEntropyLoss
learning rate: 0.1

loss见cvss。epoch1=0.1 epoch9=0.08 收敛较慢。

结果：
没有韵律。
epoch=9
> 碧 天 - 扶 桑 - 云 气 - 一 轮
< 日 来 不 风 花 无 山 年 人 春 有 雨 云 中 月 明 门 天 江 落 更 君 家 相 里 归 是 自
> 碧 天 - 扶 桑
< 不 来 风 无 花 山 春 人 有 年 雨 日 云 中 月 明 门 落 天 江 更 君 相 归 家 自 清 得
> 昨 夜 - 应 与 - 霜 葩 - 去 来
< 日 来 不 风 花 无 山 年 人 春 有 雨 云 中 月 明 门 天 江 落 更 君 家 相 里 归 是 自
> 春 风 - 长 亭 - 相 思 - 梨 花 - 杨 柳
< 日 来 不 风 花 无 年 山 人 春 有 雨 云 中 月 江 明 天 门 落 更 君 家 相 里 是 归 到
> 夕 阳 - 高 峰 影 裹 坐 - 清 泉 - 松 叶 - 蝉 噪
< 日 来 不 风 花 无 年 山 春 人 有 雨 云 中 月 江 明 天 门 落 更 君 家 相 里 是 归 到
> 霜雪
< 不 来 风 无 山 花 春 人 有 雨 年 云 日 月 中 落 天 门 明 君 更 自 清 归 相 长 江 水
> 断肠
< 不 来 风 山 无 花 春 人 有 雨 年 云 日 月 中 落 天 门 明 君 更 自 清 归 相 长 江 水
> 红烛
< 不 来 风 无 山 花 春 雨 人 有 年 云 日 月 中 落 天 门 明 君 更 自 清 归 相 长 江 水
> 杨柳
< 不 来 风 无 山 花 春 人 有 雨 年 云 日 月 中 落 天 门 明 君 更 自 清 归 相 长 江 水
> 泪
< 不 来 风 无 山 花 春 人 有 雨 年 云 日 月 中 落 天 门 明 君 更 自 清 归 相 长 江 水

结论：
1. 不同输入生成的结果高度相似。但是输入较长的和输入较短的不相似。
2. 输入即使与训练集中相同，输出也和目标很不同。
3. 第9个epoch比第1个epoch语言更像诗，更有意义。但是总的来说都比较坏。


目前模型：
training set: 58k
batch size: 80
optimizer: AdaDelta
loss: CrossEntropyLoss
learning rate: 0.1
enc_model = 'model/enc_epoch=1.pkl'
dec_model = 'model/dec_epoch=1.pkl'

epoch: 0
0m 6s (- 82m 11s) (1 0%) 0.0030
0m 23s (- 7m 24s) (37 5%) 0.0930
0m 41s (- 6m 6s) (73 10%) 0.0846
0m 58s (- 5m 29s) (109 15%) 0.0842
1m 15s (- 5m 1s) (145 20%) 0.0839
1m 32s (- 4m 38s) (181 24%) 0.0838
1m 49s (- 4m 17s) (217 29%) 0.0837
2m 6s (- 3m 56s) (253 34%) 0.0833
2m 24s (- 3m 37s) (289 39%) 0.0833
2m 41s (- 3m 18s) (325 44%) 0.0832
2m 58s (- 3m 0s) (361 49%) 0.0832
3m 15s (- 2m 41s) (397 54%) 0.0830
3m 32s (- 2m 23s) (433 59%) 0.0827
3m 49s (- 2m 5s) (469 64%) 0.0826
4m 7s (- 1m 47s) (505 69%) 0.0821
4m 24s (- 1m 29s) (541 74%) 0.0821
4m 41s (- 1m 12s) (577 79%) 0.0820
4m 58s (- 0m 54s) (613 84%) 0.0816
5m 16s (- 0m 37s) (649 89%) 0.0812
5m 33s (- 0m 19s) (685 94%) 0.0810
5m 50s (- 0m 1s) (721 99%) 0.0796
save model
epoch: 1
5m 52s (- 4256m 40s) (1 0%) 0.0112
6m 9s (- 114m 36s) (37 5%) 0.0799
6m 27s (- 57m 37s) (73 10%) 0.0801
6m 44s (- 38m 4s) (109 15%) 0.0804
7m 1s (- 28m 5s) (145 20%) 0.0797
7m 18s (- 21m 57s) (181 24%) 0.0790
7m 35s (- 17m 45s) (217 29%) 0.0785
7m 52s (- 14m 41s) (253 34%) 0.0786
8m 9s (- 12m 18s) (289 39%) 0.0772
8m 26s (- 10m 23s) (325 44%) 0.0772
8m 43s (- 8m 47s) (361 49%) 0.0767
9m 0s (- 7m 26s) (397 54%) 0.0767
9m 17s (- 6m 16s) (433 59%) 0.0757
9m 34s (- 5m 13s) (469 64%) 0.0766
9m 51s (- 4m 17s) (505 69%) 0.0753
10m 8s (- 3m 27s) (541 74%) 0.0753
10m 26s (- 2m 40s) (577 79%) 0.0754
10m 43s (- 1m 57s) (613 84%) 0.0745
11m 0s (- 1m 17s) (649 89%) 0.0762
11m 17s (- 0m 39s) (685 94%) 0.0744
11m 34s (- 0m 3s) (721 99%) 0.0745
save model

> 碧 天 - 扶 桑 - 云 气 - 一 轮
< 云 水 上 碧 山 中 天 / 月 风 雨 烟 寒 秋 花 / 不 日 青 石 下 竹 飞 / 池 亭 深 空 门 城 峰 /
> 碧 天 - 扶 桑
< 风 上 水 云 山 天 石 / 玉 翠 烟 中 秋 寒 竹 / 雨 飞 青 下 清 光 空 / 门 深 不 高 头 亭 波 /
> 昨 夜 - 应 与 - 霜 葩 - 去 来
< 风 花 春 日 归 来 不 / 人 年 处 去 山 水 月 / 江 南 秋 雨 烟 云 上 / 寒 色 雪 晴 深 中 路 /
> 春 风 - 长 亭 - 相 思 - 梨 花 - 杨 柳
< 江 风 春 花 不 日 来 / 去 水 上 山 月 梅 雨 / 落 夜 色 秋 处 人 客 / 愁 归 南 西 湖 东 路 /
> 夕 阳 - 高 峰 影 裹 坐 - 清 泉 - 松 叶 - 蝉 噪
< 山 上 青 水 不 云 天 / 风 月 雨 花 寒 落 春 / 来 人 日 夜 秋 色 江 / 去 处 归 中 西 南 路 /
> 日 影
< 风 边 水 山 云 上 秋 / 雨 烟 寒 春 花 月 色 / 绿 光 不 人 来 时 子 / 天 中 书 生 居 门 南 /
> 落 日
< 风 边 水 山 上 秋 花 / 春 日 不 人 来 年 时 / 家 中 天 门 子 未 生 / 书 居 心 名 行 南 江 /
> 乡 里
< 江 山 水 上 云 中 南 / 日 不 人 年 来 家 时 / 行 子 天 门 生 心 居 / 书 地 未 老 名 身 平 /
> 溪 居
< 江 山 水 上 云 中 不 / 人 年 来 子 心 生 书 / 天 门 地 未 家 时 名 / 居 行 老 古 平 州 南 /
> 秋 风
< 风 边 水 山 上 秋 花 / 春 雨 烟 云 寒 月 中 / 江 南 日 来 不 人 年 / 时 家 子 书 生 天 门 /
> 春 雪
< 风 边 水 上 山 秋 春 / 花 雨 色 烟 云 寒 晴 / 中 不 日 月 来 人 家 / 时 行 门 天 南 路 去 /
> 云
< 风 边 水 山 中 不 人 / 子 名 心 生 书 居 天 / 门 上 古 家 来 时 身 / 老 平 地 未 无 年 行 /
> 早 春
< 风 边 水 山 上 秋 花 / 春 日 不 人 来 年 归 / 南 江 湖 西 路 去 客 / 家 时 行 中 天 门 子 /
> 竹 泉
< 风 边 水 山 云 上 天 / 石 玉 中 不 人 子 书 / 来 未 生 名 时 居 门 / 地 平 家 心 身 老 古 /
> 
< 风 头 上 山 中 不 人 / 有 为 子 名 书 来 天 / 门 古 未 生 心 时 居 / 身 老 家 地 平 行 多 /


目前模型：
training_set = 'resource/poem_58k_theme.txt'
learning_rate = 1
batch_size = 80
epochs = 2

epoch: 0
0m 6s (- 83m 30s) (1 0%) 0.0031
0m 24s (- 7m 28s) (37 5%) 0.0893
0m 41s (- 6m 8s) (73 10%) 0.0846
0m 58s (- 5m 29s) (109 15%) 0.0839
1m 15s (- 5m 1s) (145 20%) 0.0834
1m 32s (- 4m 37s) (181 24%) 0.0825
1m 49s (- 4m 16s) (217 29%) 0.0814
2m 6s (- 3m 56s) (253 34%) 0.0807
2m 23s (- 3m 37s) (289 39%) 0.0795
2m 41s (- 3m 18s) (325 44%) 0.0780
2m 58s (- 2m 59s) (361 49%) 0.0754
3m 15s (- 2m 41s) (397 54%) 0.0740
3m 32s (- 2m 23s) (433 59%) 0.0730
3m 49s (- 2m 5s) (469 64%) 0.0788
4m 6s (- 1m 47s) (505 69%) 0.0734
4m 24s (- 1m 29s) (541 74%) 0.0734
4m 41s (- 1m 12s) (577 79%) 0.0710
4m 58s (- 0m 54s) (613 84%) 0.0723
5m 15s (- 0m 36s) (649 89%) 0.0694
5m 32s (- 0m 19s) (685 94%) 0.0679
5m 50s (- 0m 1s) (721 99%) 0.0680
save model
epoch: 1
5m 52s (- 4257m 37s) (1 0%) 0.0097
6m 9s (- 114m 39s) (37 5%) 0.0667
6m 27s (- 57m 37s) (73 10%) 0.0660
6m 44s (- 38m 5s) (109 15%) 0.0659
7m 1s (- 28m 6s) (145 20%) 0.0652
7m 18s (- 21m 59s) (181 24%) 0.0641
7m 36s (- 17m 48s) (217 29%) 0.0650
7m 53s (- 14m 43s) (253 34%) 0.0642
8m 10s (- 12m 19s) (289 39%) 0.0641
8m 27s (- 10m 24s) (325 44%) 0.0636
8m 44s (- 8m 48s) (361 49%) 0.0621
9m 1s (- 7m 27s) (397 54%) 0.0616
9m 18s (- 6m 16s) (433 59%) 0.0628
9m 36s (- 5m 14s) (469 64%) 0.0625
9m 53s (- 4m 18s) (505 69%) 0.0608
10m 10s (- 3m 27s) (541 74%) 0.0590
10m 27s (- 2m 40s) (577 79%) 0.0623
10m 44s (- 1m 57s) (613 84%) 0.0605
11m 1s (- 1m 17s) (649 89%) 0.0610
11m 19s (- 0m 39s) (685 94%) 0.0605
11m 36s (- 0m 3s) (721 99%) 0.0595
save model

epoch1：
> 碧 天 - 扶 桑 - 云 气 - 一 轮
< 天 上 高 风 动 地 开 / 桑 叶 云 间 碧 玉 光 / 里 色 青 松 下 石 树 / 阴 外 与 君 家 水 不 /
> 碧 天 - 扶 桑
< 桑 叶 落 天 边 水 上 / 青 山 下 碧 云 间 片 / 绿 阴 风 露 色 无 双 / 石 树 南 湖 外 雨 空 /
> 昨 夜 - 应 与 - 霜 葩 - 去 来
< 夜 来 闻 我 见 秋 风 / 与 别 家 人 不 及 春 / 月 色 霜 华 花 落 日 / 长 安 可 惜 昨 时 至 /
> 春 风 - 长 亭 - 相 思 - 梨 花 - 杨 柳
< 春 风 吹 柳 满 人 家 / 亭 上 曲 楼 前 日 暮 / 长 相 见 别 花 枝 绿 / 叶 落 时 多 少 年 不 /
> 夕 阳 - 高 峰 影 裹 坐 - 清 泉 - 松 叶 - 蝉 噪
< 夕 阳 高 阁 数 峰 寺 / 坐 午 日 长 泉 静 林 / 声 松 下 清 风 露 叶 / 中 庭 月 色 深 蝉 树 /
> 日 影
< 月 影 无 人 事 照 日 / 斜 风 光 落 摇 碧 树 / 花 边 水 上 湖 窗 下 / 玉 楼 如 古 寒 色 长 /
> 落 日
< 日 落 花 开 树 鸟 飞 / 来 去 尽 春 风 雨 满 / 天 城 西 山 下 月 明 / 时 见 雪 光 如 何 处 /
> 乡 里
< 里 来 如 此 去 乡 家 / 城 上 梦 中 湖 水 边 / 春 别 客 相 思 载 月 / 长 安 得 归 山 下 楼 /
> 溪 居
< 溪 上 水 边 春 舍 近 / 居 人 间 隐 山 茅 屋 / 竹 径 深 处 问 家 林 / 所 访 僧 房 野 老 庐 /
> 秋 风
< 风 雨 过 秋 光 叶 满 / 庭 花 落 日 长 生 竹 / 树 阴 林 不 见 春 江 / 上 月 天 西 湖 下 玉 /
> 春 雪
< 春 风 雪 里 来 花 雨 / 满 天 头 白 玉 枝 霜 / 月 腊 长 日 暮 山 梅 / 云 上 晴 寒 片 落 南 /
> 云
< 云 外 山 间 人 不 见 / 天 上 玉 城 台 高 日 / 暮 雨 雪 飞 何 处 如 / 白 雾 里 春 望 南 水 /
> 早 春
< 春 风 不 得 归 花 过 / 日 长 安 可 惜 早 晚 / 晴 天 上 雨 初 开 树 / 柳 阴 深 处 好 时 新 /
> 竹 泉
< 竹 外 松 泉 水 底 石 / 盘 上 涧 边 流 下 溪 / 根 长 日 径 深 处 近 / 茅 屋 间 人 傍 玉 池 /
> 
< 风 雨 不 如 何 处 人 / 间 事 已 见 君 家 女 / 子 文 章 上 树 中 春 / 色 长 安 道 南 山 下 /

epoch9：
碧 天 - 扶 桑 - 云 气 - 一 轮  ====  天 气 长 安 倚 碧 云 / 风 起 龙 山 上 客 中 / 来 不 挂 月 轮 转 高 / 桂 昨 夜 深 空 有 玉 /
碧 天 - 扶 桑  ====  天 然 扶 上 倚 西 根 / 转 日 午 鸡 鸣 玉 井 / 东 风 起 来 时 节 客 / 中 人 去 不 知 几 度 /
昨 夜 - 应 与 - 霜 葩 - 去 来  ====  昨 夜 霜 中 雪 未 应 / 时 节 红 树 下 不 成 / 秋 风 去 来 看 花 落 / 尽 日 月 冷 冰 梦 似 /
春 风 - 长 亭 - 相 思 - 梨 花 - 杨 柳  ====  春 风 长 日 送 客 亭 / 相 对 别 离 山 思 情 / 梨 花 满 地 不 如 杨 / 柳 絮 成 雪 去 时 折 /
夕 阳 - 高 峰 影 裹 坐 - 清 泉 - 松 叶 - 蝉 噪  ====  夕 阳 西 晚 立 高 秋 / 影 月 转 孤 山 坐 见 / 松 泉 落 尽 清 叶 满 / 林 树 外 蝉 声 卧 看 /
日 影  ====  日 月 明 朝 影 转 长 / 安 道 人 家 山 水 上 / 天 风 不 知 旧 时 节 / 中 别 后 去 年 华 发 /
落 日  ====  落 日 斜 阳 照 夕 晖 / 空 断 山 青 天 上 客 / 来 时 节 嘉 人 生 晚 / 风 传 得 几 度 月 痕 /
乡 里  ====  乡 里 相 望 远 不 知 / 君 莫 道 人 家 住 山 / 西 风 起 梦 中 来 往 / 事 已 成 空 自 别 无 /
溪 居  ====  居 士 山 头 溪 上 松 / 江 水 边 树 映 白 云 / 寒 作 去 来 不 得 似 / 何 所 在 心 情 别 有 /
秋 风  ====  秋 风 吹 尽 鬓 如 丝 / 叶 树 上 霜 毛 羽 子 / 安 得 去 时 节 物 已 / 成 却 是 谁 知 旧 隐 /
春 雪  ====  雪 满 春 风 积 雨 余 / 园 树 花 开 见 绿 阴 / 山 下 马 上 看 来 不 / 知 几 时 节 物 已 成 /
云  ====  云 山 不 去 雪 天 关 / 雾 上 头 树 下 马 门 / 外 见 人 间 世 事 已 / 成 空 翠 作 心 别 有 /
早 春  ====  春 风 早 晚 未 知 时 / 节 物 上 心 情 苦 辛 / 勤 得 似 人 间 事 已 / 成 空 翠 积 雪 霜 满 /
竹 泉  ====  泉 石 清 溪 水 涧 幽 / 深 闭 门 外 山 下 马 / 去 来 时 节 晚 风 传 / 得 似 霜 冷 云 上 午 /
  ====  天 上 无 数 日 月 明 / 朝 午 夜 寒 松 柏 子 / 规 相 对 君 王 母 自 / 是 非 心 事 已 成 空 /
  
  碧 天 - 扶 桑 - 云 气 - 一 轮  ====  天 上 长 干 碧 云 横 / 转 日 午 鸡 鸣 水 气 / 烟 月 照 空 绝 点 白 / 石 方 成 雨 声 中 落 /
碧 天 - 扶 桑  ====  天 然 扶 上 倚 苍 立 / 桑 树 转 高 村 东 风 / 定 是 非 心 事 已 成 / 空 翠 羽 飞 来 访 仙 /
昨 夜 - 应 与 - 霜 葩 - 去 来  ====  昨 夜 霜 风 破 晓 时 / 寒 玉 树 花 枝 上 看 / 不 受 早 来 去 却 见 / 红 面 似 梦 中 白 羽 /
春 风 - 长 亭 - 相 思 - 梨 花 - 杨 柳  ====  春 风 长 日 送 客 回 / 亭 下 相 门 西 别 有 / 情 如 旧 山 东 去 不 / 成 杨 柳 堤 上 月 明 /
夕 阳 - 高 峰 影 裹 坐 - 清 泉 - 松 叶 - 蝉 噪  ====  夕 阳 高 树 晚 蝉 鸣 / 影 月 团 坐 底 清 泉 / 落 松 叶 外 秋 风 满 / 庭 竹 枝 阴 边 日 斜 /
日 影  ====  日 月 斜 空 照 影 稀 / 山 下 头 白 发 落 花 / 飞 去 不 知 处 是 人 / 间 几 度 秋 风 来 时 /
落 日  ====  落 花 满 目 尽 天 津 / 笛 月 明 空 山 水 上 / 松 梢 不 见 人 来 往 / 事 已 成 阴 树 下 头 /
乡 里  ====  乡 里 相 望 远 不 知 / 君 莫 道 人 家 住 山 / 西 风 起 去 时 来 几 / 度 月 明 朝 阳 日 午 /
溪 居  ====  居 士 无 人 厌 隐 山 / 溪 水 如 何 所 似 相 / 对 处 觅 君 王 子 细 / 看 尽 日 不 知 是 我 /
秋 风  ====  秋 风 吹 尽 雁 鸣 声 / 里 去 不 知 君 莫 道 / 人 间 世 事 已 成 空 / 落 日 月 明 朝 未 得 /
春 雪  ====  雪 满 春 风 积 雨 余 / 园 几 度 新 成 不 见 / 花 时 节 看 尽 日 午 / 长 安 得 去 年 华 发 /
云  ====  云 山 不 见 雪 天 寒 / 雾 上 头 白 石 客 来 / 往 复 何 如 许 似 人 / 间 世 事 已 成 空 涧 /
早 春  ====  春 风 催 得 早 朝 来 / 晚 岁 华 年 事 已 成 / 名 上 看 花 发 向 去 / 时 节 物 莫 嫌 客 子 /
竹 泉  ====  泉 水 松 溪 竹 涧 幽 / 林 壑 深 处 寻 常 在 / 心 无 数 尺 云 烟 上 / 头 白 露 冷 山 空 抱 /
  ====  天 上 无 数 两 度 春 / 风 起 来 时 节 物 中 / 有 几 许 人 不 见 诗 / 成 却 是 谁 知 玉 树 /